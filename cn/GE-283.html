<!doctype html>
<html lang="zh-cmn-Hant">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>京都大學藏中國民俗人偶</title>
    <style>
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="../lightbox2-2.11.4/css/lightbox.min.css">
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-expand-lg" aria-label="Ninth navbar example">
        <div class="container-xl">
          <a class="navbar-brand h1" href="#">京都大學藏中國民俗人偶</a>
          <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample07XL" aria-controls="navbarsExample07XL" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
    
          <div class="navbar-collapse collapse" id="navbarsExample07XL">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="top.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="about.html">About</a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">繁體中文</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" id="langen">English</a></li>
                  <li><a class="dropdown-item" id="langja">日本語</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>


      <div class="row" id="contents">
      </div>


      <table class="table">
        <tbody id = "tableBody">
        </tbody>
      </table>


      <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
        <div class="d-flex align-items-center">
          <span class="mb-3 mb-md-0 text-body-secondary">(c) <a class="link-darker-gray" href="https://www.bun.kyoto-u.ac.jp/geography/geo-top_page/">京都大学大学院文学研究科・地理学専修</a> All rights reserved.</span>
        </div>
      </footer>

    </div>

    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script src="../lightbox2-2.11.4/js/lightbox-plus-jquery.js"></script>
    <script src="https://js.arcgis.com/4.31/"></script>
    <script>

      require([
          "esri/layers/FeatureLayer"
        ], function(
          FeatureLayer
        ) {

          const filename = window.location.href.split('/').pop().replace(".html", "");
          document.title = filename;

          const langja = document.getElementById("langja");
          langja.href = "../ja/" + filename + ".html";

          const langen = document.getElementById("langen");
          langen.href = "../en/" + filename + ".html";

          const contents =  document.getElementById("contents");
          const tableBody = document.getElementById("tableBody");
          const modalBody = document.getElementById("modalBody");


          const metadataFL = new FeatureLayer({
            url: "https://services9.arcgis.com/qKCfk1d1Trl16kF0/arcgis/rest/services/chineseDollsMetadata_v3/FeatureServer/0"
          });

          const queryParams = metadataFL.createQuery();
          queryParams.returnGeometry = false;
          queryParams.where = "id = '" + filename + "' AND lang = 'cn'" ;
          queryParams.outFields = ["*"];

          metadataFL.queryFeatures(queryParams)
          .then(addImage)
          .catch(function(error) {
            console.log(error);
          });

          function addImage(response){

            console.log(response);

            const imgcnt = response.features[0].attributes.ImgCnt;
            const link3d = response.features[0].attributes.link3d;

            var starti ;
            if (link3d) {
              starti = 0;
            } else {
              starti = 1;
            }
            for(let i = starti; i <= imgcnt; i++) {

              const imgpath = "../img/" + filename + "_" + i + "_resize.jpg";

              const card = document.createElement('div');
              card.classList.add("card");
              card.classList.add("col-md-3");
              contents.appendChild(card);

              if (i==0) {
                const anchor = document.createElement("a");
                anchor.setAttribute("href", link3d);
                anchor.setAttribute("target", "_blank");
                card.appendChild(anchor);

                const img = document.createElement("img");
                img.setAttribute("src", imgpath);
                img.classList.add("card-img-top");
                anchor.appendChild(img);
              } else {
                const anchor = document.createElement("a");
                anchor.setAttribute("href", imgpath);
                anchor.setAttribute("data-lightbox", filename);
                card.appendChild(anchor);

                const img = document.createElement("img");
                img.setAttribute("src", imgpath);
                img.classList.add("card-img-top");
                anchor.appendChild(img);
              };
              
            };

            const lstFld = [
              {fldname: "group_", alias_ja: "分類", alias_en: "Classification", alias_cn: "分類"},
              {fldname: "id", alias_ja: "民族資料整理番号", alias_en: "Reference number of ethnic materials", alias_cn: "民族資料編號"},
              {fldname: "size", alias_ja: "寸法（底面；高さ）単位cm", alias_en: "Size (Bottom; Height) (cm)", alias_cn: "尺寸（底面；高度）單位cm"},
              {fldname: "material", alias_ja: "素材等", alias_en: "Materials, etc. ", alias_cn: "原材料等"},
              {fldname: "purchase_record", alias_ja: "購入記録", alias_en: "Purcase records", alias_cn: "購買紀錄"},
              {fldname: "equipment_id", alias_ja: "備品番号（平成10年4月1日)", alias_en: "Equipment registration number (dated on April 1, 1998) ", alias_cn: "教研器材序號（1998年4月1日)"},
              {fldname: "same_type_record1", alias_ja: "同種資料(1)", alias_en: "Similar material (1) ", alias_cn: "同類資料(1)"},
              {fldname: "same_type_record2", alias_ja: "同種資料(2)", alias_en: "Similar material (2) ", alias_cn: "同類資料(2)"},
              {fldname: "same_type_record3", alias_ja: "同種資料(3)", alias_en: "Similar material (3) ", alias_cn: "同類資料(3)"},
              {fldname: "note", alias_ja: "備考", alias_en: "Notes", alias_cn: "備註"}
            ];




            for(let j = 0; j < lstFld.length; j++) {

              const tableRecord = document.createElement("tr");
              tableBody.appendChild(tableRecord);

              const tableData1 = document.createElement("td");
              tableData1.innerHTML = lstFld[j].alias_cn;
              tableRecord.appendChild(tableData1);

              const tableData2 = document.createElement("td");
              tableData2.innerHTML = response.features[0].attributes[lstFld[j].fldname];
              tableRecord.appendChild(tableData2);
            };


            

          };

      });

    </script>
  
  </body>
</html>